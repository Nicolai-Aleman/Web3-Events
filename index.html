<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web3 Strategic Events Calendar 2026</title>

  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ical.js@1.4.0/build/ical.min.js"></script>

  <style>
    :root{
      --bg:#f4f6f9; --card:#fff; --text:#111827; --muted:#6b7280; --border:#e5e7eb;
      --shadow:0 14px 30px rgba(17,24,39,.08); --shadow2:0 12px 24px rgba(17,24,39,.18);
      --radius:12px; --btn:#111827; --btnText:#fff; --btnSoft:#fff; --btnSoftText:#111827;
    }

    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:28px 16px;color:var(--text)}
    .wrap{max-width:1120px;margin:0 auto}
    header{display:flex;flex-direction:column;gap:10px;margin-bottom:16px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:24px;font-weight:750;letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:14px;margin:0;line-height:1.4}

    #calendar{background:var(--card);padding:18px;border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid var(--border)}

    /* Modal */
    .modal-overlay{
      position:fixed;inset:0;background:rgba(17,24,39,.55);display:none;align-items:center;justify-content:center;
      padding:16px;z-index:9999
    }
    .modal{
      width:min(860px,100%);background:var(--card);border-radius:14px;box-shadow:var(--shadow2);
      border:1px solid var(--border);overflow:hidden
    }
    .modal-header{
      display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:16px 16px 10px 16px;
      border-bottom:1px solid var(--border);background:#fbfbfd
    }
    .modal-title{margin:0;font-size:18px;font-weight:750;line-height:1.3}
    .modal-meta{margin-top:6px;color:var(--muted);font-size:13px;display:flex;flex-wrap:wrap;gap:10px}
    .pill{
      display:inline-flex;align-items:center;padding:5px 10px;border:1px solid var(--border);border-radius:999px;
      background:#fff;font-size:12px;color:#374151
    }
    .modal-close{
      border:1px solid var(--border);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer;
      font-weight:750;color:#111827;font-size:13px
    }
    .modal-body{padding:14px 16px 16px 16px;display:grid;grid-template-columns:1fr;gap:12px}
    .section{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff}
    .section h3{margin:0 0 6px 0;font-size:12px;color:#374151;letter-spacing:.2px;text-transform:uppercase}
    .section p{margin:0;color:#111827;font-size:14px;line-height:1.45;white-space:pre-wrap}
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    .event-actions{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-start;
      padding-top:4px;
    }
    .btn{
      appearance:none;border:1px solid var(--border);background:var(--btn);color:var(--btnText);
      border-radius:10px;padding:10px 12px;font-weight:800;cursor:pointer;font-size:13px;
      width: 100%;
    }
    .hint{color:var(--muted);font-size:12.5px;line-height:1.35;margin:0}

    @media (max-width:760px){
      .two-col{grid-template-columns:1fr}
      body{padding:20px 12px}
    }

    /* FullCalendar polish */
    .fc .fc-toolbar-title{font-size:18px;font-weight:750}
    .fc .fc-button{border-radius:10px}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="topbar">
        <h1>Web3 Strategic Events Calendar 2026</h1>
      </div>
      <p class="subtitle">Click an event to see details and add it to Apple Calendar.</p>
    </header>

    <div id="calendar"></div>
  </div>

  <!-- Event Details Modal -->
  <div id="eventModalOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="eventModalTitle">
      <div class="modal-header">
        <div>
          <h2 id="eventModalTitle" class="modal-title">Event</h2>
          <div class="modal-meta">
            <span id="eventModalDate" class="pill">Date</span>
            <span id="eventModalLocation" class="pill" style="display:none;">Location</span>
          </div>
        </div>
        <button id="eventModalClose" class="modal-close" type="button">Close</button>
      </div>

      <div class="modal-body">
        <div class="section">
          <div class="event-actions">
            <button id="addToAppleBtn" class="btn" type="button">Add to Apple Calendar</button>
          </div>
          <p class="hint" style="margin-top:10px;">
            Best experience on Safari (iPhone/Mac). This adds only this event, not the entire calendar.
          </p>
        </div>

        <div class="two-col">
          <div class="section">
            <h3>Primary focus</h3>
            <p id="eventModalFocus">—</p>
          </div>
          <div class="section">
            <h3>Ideal audience</h3>
            <p id="eventModalAudience">—</p>
          </div>
        </div>

        <div class="section">
          <h3>Strategic relevance</h3>
          <p id="eventModalRelevance">—</p>
        </div>

        <div class="section">
          <h3>Notes</h3>
          <p id="eventModalNotes">—</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Keep your full ICS in the same folder as this index.html (for calendar rendering)
    const ICS_FILENAME = "Calendario_Eventos_Web3_2026.ics";

    // Optional enriched details per event title (must match SUMMARY in the ICS exactly).
    const EVENT_DETAILS = {
      "CfC St. Moritz": {
        location: "St. Moritz, Switzerland",
        focus: "Institutional, high-level digital finance discussions.",
        audience: "Funds, private banks, family offices, and regulators.",
        relevance: "Selective setting for strategic conversations and executive positioning.",
        notes: "Best suited for CEO-level networking and confidential discussions."
      },
      "Consensus Hong Kong": {
        location: "Hong Kong",
        focus: "Institutional capital and Asia-focused Web3 market structure.",
        audience: "Builders, investors, institutions, and policymakers.",
        relevance: "High signal for Asia expansion, partnerships, and regulatory alignment.",
        notes: "Use for capital conversations and cross-border distribution opportunities."
      },
      "ETHDenver": {
        location: "Denver, United States",
        focus: "Technical Web3 development and builder ecosystem.",
        audience: "Developers, protocol teams, product engineers.",
        relevance: "Best for product, engineering, and ecosystem integrations.",
        notes: "Ideal if you have a technical roadmap (wallets, rails, smart contracts, infrastructure)."
      }
      // Add more as needed...
    };

    function pad2(n){ return String(n).padStart(2, "0"); }
    function icalDateToISODate(t){ return `${t.year}-${pad2(t.month)}-${pad2(t.day)}`; }

    function formatDisplayDate(start, end, allDay){
      const opts = { year:"numeric", month:"short", day:"2-digit" };
      const s = allDay ? new Date(start + "T00:00:00") : new Date(start);
      let e = end ? (allDay ? new Date(end + "T00:00:00") : new Date(end)) : null;
      if (!e) return s.toLocaleDateString("en-US", opts);
      if (allDay) e.setDate(e.getDate() - 1);
      if (s.toDateString() === e.toDateString()) return s.toLocaleDateString("en-US", opts);
      return `${s.toLocaleDateString("en-US", opts)} to ${e.toLocaleDateString("en-US", opts)}`;
    }

    function openOverlay(id, focusId){
      const overlay = document.getElementById(id);
      overlay.style.display = "flex";
      overlay.setAttribute("aria-hidden", "false");
      if (focusId){
        const el = document.getElementById(focusId);
        if (el) setTimeout(() => el.focus(), 0);
      }
    }
    function closeOverlay(id){
      const overlay = document.getElementById(id);
      overlay.style.display = "none";
      overlay.setAttribute("aria-hidden", "true");
    }

    // --- Apple Calendar: Create a single-event ICS and open it ---
    function escapeIcsText(s){
      return String(s || "")
        .replace(/\\\\/g, "\\\\\\\\")
        .replace(/\\n/g, "\\\\n")
        .replace(/\\r/g, "")
        .replace(/,/g, "\\\\,")
        .replace(/;/g, "\\\\;");
    }

    function toIcsUtc(dt){
      // dt is JS Date
      const y = dt.getUTCFullYear();
      const m = pad2(dt.getUTCMonth()+1);
      const d = pad2(dt.getUTCDate());
      const hh = pad2(dt.getUTCHours());
      const mm = pad2(dt.getUTCMinutes());
      const ss = pad2(dt.getUTCSeconds());
      return `${y}${m}${d}T${hh}${mm}${ss}Z`;
    }

    function buildSingleEventIcs({ title, start, end, allDay, description, location }){
      const uid = `web3-${Math.random().toString(16).slice(2)}@nicolai-aleman.github.io`;
      const now = toIcsUtc(new Date());

      let dtStartLine = "";
      let dtEndLine = "";

      if (allDay){
        // FullCalendar all-day dates are YYYY-MM-DD
        // iCalendar for all-day uses VALUE=DATE and DTEND is exclusive
        dtStartLine = `DTSTART;VALUE=DATE:${start.replaceAll("-","")}`;

        if (end){
          dtEndLine = `DTEND;VALUE=DATE:${end.replaceAll("-","")}`;
        } else {
          // If no end, make it a 1-day event by setting DTEND = start + 1 day
          const s = new Date(start + "T00:00:00");
          s.setDate(s.getDate() + 1);
          const y = s.getFullYear();
          const m = pad2(s.getMonth()+1);
          const d = pad2(s.getDate());
          dtEndLine = `DTEND;VALUE=DATE:${y}${m}${d}`;
        }
      } else {
        const s = new Date(start);
        const e = end ? new Date(end) : new Date(s.getTime() + 60*60*1000);
        dtStartLine = `DTSTART:${toIcsUtc(s)}`;
        dtEndLine = `DTEND:${toIcsUtc(e)}`;
      }

      const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Web3 Events//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${now}
SUMMARY:${escapeIcsText(title)}
${dtStartLine}
${dtEndLine}
${location ? "LOCATION:" + escapeIcsText(location) : ""}
DESCRIPTION:${escapeIcsText(description || "")}
END:VEVENT
END:VCALENDAR`;

      return ics.replace(/\\n/g, "\\r\\n");
    }

    function openAppleCalendarForEvent(icsText){
      // data URL approach: triggers Apple Calendar import on Safari/iOS/macOS
      const blob = new Blob([icsText], { type: "text/calendar;charset=utf-8" });
      const url = URL.createObjectURL(blob);

      // Opening the blob URL in same tab is more reliable for Safari import flows
      window.location.href = url;

      // Cleanup after a while
      setTimeout(() => URL.revokeObjectURL(url), 60000);
    }

    // Store the currently selected event data for the "Add to Apple Calendar" button
    let CURRENT_EVENT_PAYLOAD = null;

    document.addEventListener("DOMContentLoaded", async function(){
      // Modal handlers
      document.getElementById("eventModalClose").addEventListener("click", () => closeOverlay("eventModalOverlay"));
      document.getElementById("eventModalOverlay").addEventListener("click", function(e){
        if (e.target === this) closeOverlay("eventModalOverlay");
      });
      document.addEventListener("keydown", function(e){
        if (e.key === "Escape") closeOverlay("eventModalOverlay");
      });

      document.getElementById("addToAppleBtn").addEventListener("click", function(){
        if (!CURRENT_EVENT_PAYLOAD) return;

        const ics = buildSingleEventIcs(CURRENT_EVENT_PAYLOAD);
        openAppleCalendarForEvent(ics);
      });

      // Load full ICS to render calendar
      const response = await fetch(ICS_FILENAME);
      const text = await response.text();

      const jcalData = ICAL.parse(text);
      const comp = new ICAL.Component(jcalData);
      const vevents = comp.getAllSubcomponents("vevent");

      const events = vevents.map(event => {
        const e = new ICAL.Event(event);
        const isAllDay = e.startDate && e.startDate.isDate === true;

        let startVal, endVal;
        if (isAllDay){
          startVal = icalDateToISODate(e.startDate); // YYYY-MM-DD
          endVal = e.endDate ? icalDateToISODate(e.endDate) : null; // exclusive end
        } else {
          startVal = e.startDate ? e.startDate.toJSDate().toISOString() : null;
          endVal = e.endDate ? e.endDate.toJSDate().toISOString() : null;
        }

        return {
          title: e.summary || "Event",
          start: startVal,
          end: endVal,
          allDay: isAllDay,
          extendedProps: { description: e.description || "" }
        };
      });

      const calendar = new FullCalendar.Calendar(document.getElementById("calendar"), {
        initialView: "dayGridMonth",
        initialDate: "2026-01-01",
        locale: "en",
        height: "auto",
        headerToolbar: { left: "prev,next today", center: "title", right: "dayGridMonth,listMonth" },
        events,
        eventClick: function(info){
          info.jsEvent.preventDefault();

          const title = info.event.title;
          const details = EVENT_DETAILS[title] || {};

          const start = info.event.allDay ? info.event.startStr : (info.event.start ? info.event.start.toISOString() : null);
          const end = info.event.allDay ? (info.event.endStr || null) : (info.event.end ? info.event.end.toISOString() : null);
          const displayDate = formatDisplayDate(start, end, info.event.allDay);

          // Fill modal text
          document.getElementById("eventModalTitle").textContent = title;
          document.getElementById("eventModalDate").textContent = displayDate;

          const locEl = document.getElementById("eventModalLocation");
          if (details.location){
            locEl.style.display = "inline-flex";
            locEl.textContent = details.location;
          } else {
            locEl.style.display = "none";
          }

          document.getElementById("eventModalFocus").textContent = details.focus || "—";
          document.getElementById("eventModalAudience").textContent = details.audience || "—";
          document.getElementById("eventModalRelevance").textContent = details.relevance || "—";
          document.getElementById("eventModalNotes").textContent =
            details.notes || info.event.extendedProps.description || "—";

          // Prepare payload for single-event ICS
          CURRENT_EVENT_PAYLOAD = {
            title,
            start: info.event.allDay ? info.event.startStr : info.event.start.toISOString(),
            end: info.event.allDay ? (info.event.endStr || null) : (info.event.end ? info.event.end.toISOString() : null),
            allDay: info.event.allDay,
            description: details.notes || info.event.extendedProps.description || "",
            location: details.location || ""
          };

          openOverlay("eventModalOverlay", "addToAppleBtn");
        }
      });

      calendar.render();
    });
  </script>
</body>
</html>
